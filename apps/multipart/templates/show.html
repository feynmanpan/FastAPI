<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>multipart test</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'
        integrity='sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=='
        crossorigin='anonymous'></script>
</head>

<body>

</body>
<script>
    //
    function download(blob, name, type) {
        var a = document.createElement("a");
        document.body.appendChild(a);
        a.href = URL.createObjectURL(blob);
        a.download = name;
        a.click();
    }
    //
    fetch("/mp?ajax=1&suc={{suc}}&err={{err}}", { method: "GET" })
        .then(res => res.formData())
        .then(fd => {
            const msg = JSON.parse(fd.get('msg'));
            if (msg['success'] == 1) {
                const file = fd.get('file');
                Promise.resolve(file.arrayBuffer())
                    .then(value => {
                        const blob = new Blob([value], { type: file.type });
                        // 下載
                        download(blob, file.name, file.type);
                        // base64
                        var reader = new FileReader();
                        reader.readAsDataURL(blob);
                        reader.onloadend = function () {
                            $("body").append('<img src="' + reader.result + '" />');
                        };
                    });
            } else {
                $("body").text('err: ' + msg['err']);
            };
        });
</script>

</html>